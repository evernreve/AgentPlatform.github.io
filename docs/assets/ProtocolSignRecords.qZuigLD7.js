import{_ as U,i as Y,c as p,o as m,b as e,a,w as s,r as l,d as r,t as d,e as M,F as N,f as T}from"./index.DkWATejZ.js";const B={name:"ProtocolSignRecords",components:{Document:Y},data(){return{protocolId:"",protocolInfo:{name:"",version:""},filters:{accountNumber:"",userName:"",signTime:["",""]},signRecords:[{id:1,accountNumber:"ACC00120240115",userName:"张三",protocolCreator:"PP",protocolCreatorName:"IPL集团",version:"V20260129",signTime:"2026-01-29 15:30:22",signAction:"first_sign",ipAddress:"192.168.1.100",deviceInfo:"Windows Chrome",status:"completed",snapshot:{protocolName:"断直连协议",version:"V20260129",signTime:"2026-01-29 15:30:22",userName:"张三",attachments:[{name:"断直连协议_cn.pdf",url:"/files/断直连协议_cn.pdf"}],images:[{url:"/images/协议示例_cn.png"}]}},{id:2,accountNumber:"ACC00220240120",userName:"李四",protocolCreator:"TP",protocolCreatorName:"合作伙伴科技",version:"V20260120",signTime:"2026-01-20 10:15:30",signAction:"re_sign",ipAddress:"192.168.1.101",deviceInfo:"Mac Safari",status:"completed",snapshot:{protocolName:"断直连协议",version:"V20260120",signTime:"2026-01-20 10:15:30",userName:"李四",attachments:[{name:"断直连协议_old.pdf",url:"/files/断直连协议_old.pdf"}],images:[]}},{id:3,accountNumber:"ACC00320240115",userName:"王五",protocolCreator:"PP",protocolCreatorName:"IPL集团",version:"V20260129",signTime:"2026-01-29 16:45:12",signAction:"first_sign",ipAddress:"192.168.1.102",deviceInfo:"iPhone Safari",status:"completed",snapshot:{protocolName:"断直连协议",version:"V20260129",signTime:"2026-01-29 16:45:12",userName:"王五",attachments:[{name:"断直连协议_cn.pdf",url:"/files/断直连协议_cn.pdf"},{name:"Disconnection_Protocol_en.pdf",url:"/files/Disconnection_Protocol_en.pdf"}],images:[{url:"/images/协议示例_cn.png"},{url:"/images/Protocol_Example_en.png"}]}}],pagination:{currentPage:1,pageSize:10,total:0},detailDrawerVisible:!1,previewDialogVisible:!1,previewDialogTitle:"",previewFileUrl:"",previewFileType:"",selectedRecord:{}}},created(){this.protocolId=this.$route.params.protocolId||this.$route.query.protocolId,this.loadProtocolInfo(),this.loadSignRecords()},methods:{loadProtocolInfo(){this.protocolInfo={name:"断直连协议",version:"V20260129"}},loadSignRecords(){this.signRecords=[{id:1,accountNumber:"ACC00120240115",userName:"张三",protocolCreator:"PP",protocolCreatorName:"IPL集团",version:"V20260129",signTime:"2026-01-29 15:30:22",signAction:"first_sign",ipAddress:"192.168.1.100",deviceInfo:"Windows Chrome",status:"completed",snapshot:{protocolName:"断直连协议",version:"V20260129",signTime:"2026-01-29 15:30:22",userName:"张三",attachments:[{name:"断直连协议_cn.pdf",url:"/files/断直连协议_cn.pdf"}],images:[{url:"/images/协议示例_cn.png"}]}},{id:2,accountNumber:"ACC00220240120",userName:"李四",protocolCreator:"TP",protocolCreatorName:"合作伙伴科技",version:"V20260120",signTime:"2026-01-20 10:15:30",signAction:"re_sign",ipAddress:"192.168.1.101",deviceInfo:"Mac Safari",status:"completed",snapshot:{protocolName:"断直连协议",version:"V20260120",signTime:"2026-01-20 10:15:30",userName:"李四",attachments:[{name:"断直连协议_old.pdf",url:"/files/断直连协议_old.pdf"}],images:[]}},{id:3,accountNumber:"ACC00320240115",userName:"王五",protocolCreator:"PP",protocolCreatorName:"IPL集团",version:"V20260129",signTime:"2026-01-29 16:45:12",signAction:"first_sign",ipAddress:"192.168.1.102",deviceInfo:"iPhone Safari",status:"completed",snapshot:{protocolName:"断直连协议",version:"V20260129",signTime:"2026-01-29 16:45:12",userName:"王五",attachments:[{name:"断直连协议_cn.pdf",url:"/files/断直连协议_cn.pdf"},{name:"Disconnection_Protocol_en.pdf",url:"/files/Disconnection_Protocol_en.pdf"}],images:[{url:"/images/协议示例_cn.png"},{url:"/images/Protocol_Example_en.png"}]}}],this.pagination.total=this.signRecords.length},handleSearch(){console.log("搜索条件:",this.filters),this.$message.success("查询成功")},handleReset(){this.filters={accountNumber:"",userName:"",signTime:["",""]}},handleSizeChange(n){this.pagination.pageSize=n},handleCurrentChange(n){this.pagination.currentPage=n},viewSnapshot(n){this.currentSnapshot=n.snapshot,this.snapshotDrawerVisible=!0},viewSignDetail(n){this.selectedRecord=n,this.detailDrawerVisible=!0},goBack(){this.$router.push("/main/monitor/contracts/protocol-management")},previewAttachment(n){this.previewDialogTitle=n.name,this.previewFileUrl=n.url;const t=n.name.split(".").pop().toLowerCase();["pdf"].includes(t)?this.previewFileType="pdf":["jpg","jpeg","png","gif"].includes(t)?this.previewFileType="image":this.previewFileType="other",this.previewDialogVisible=!0},downloadFile(){this.$message.success("开始下载文件...")},getSignActionTagType(n){return{first_sign:"success",re_sign:"warning"}[n]||"info"},getSignActionLabel(n){return{first_sign:"首次签署",re_sign:"重新签署"}[n]||n},getCreatorTagType(n){return{PP:"primary",TP:"success",AP:"warning"}[n]||"info"}}},j={class:"protocol-sign-records"},E={class:"page-header"},W={class:"detail-content"},q={class:"card-header"},G={class:"snapshot-section"},H={key:0},J={key:1},K={class:"snapshot-section",style:{"margin-top":"20px"}},O={key:0},Q={key:1},X={class:"preview-content"},Z=["src"],$=["src"],ee={key:2};function te(n,t,oe,se,o,c){const w=l("el-breadcrumb-item"),V=l("el-breadcrumb"),_=l("el-button"),C=l("el-input"),f=l("el-form-item"),P=l("el-date-picker"),A=l("el-form"),b=l("el-card"),u=l("el-table-column"),h=l("el-tag"),R=l("el-table"),k=l("el-pagination"),g=l("el-descriptions-item"),S=l("el-descriptions"),D=l("Document"),x=l("el-icon"),I=l("el-link"),F=l("el-image"),z=l("el-drawer"),L=l("el-dialog");return m(),p("div",j,[e(V,{separator:"/",class:"breadcrumb"},{default:s(()=>[e(w,{to:{path:"/main/monitor/contracts/protocol-management"}},{default:s(()=>[...t[5]||(t[5]=[r("协议管理",-1)])]),_:1}),e(w,null,{default:s(()=>[r(d(o.protocolInfo.name)+"签署详情",1)]),_:1})]),_:1}),a("div",E,[t[7]||(t[7]=a("h2",null,"协议签署记录",-1)),e(_,{onClick:c.goBack,type:"primary",plain:""},{default:s(()=>[...t[6]||(t[6]=[r("返回协议列表",-1)])]),_:1},8,["onClick"])]),e(b,{class:"filter-card"},{default:s(()=>[e(A,{inline:!0,model:o.filters,class:"filter-form"},{default:s(()=>[e(f,{label:"账户号码"},{default:s(()=>[e(C,{modelValue:o.filters.accountNumber,"onUpdate:modelValue":t[0]||(t[0]=i=>o.filters.accountNumber=i),placeholder:"请输入账户号码",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"用户名称"},{default:s(()=>[e(C,{modelValue:o.filters.userName,"onUpdate:modelValue":t[1]||(t[1]=i=>o.filters.userName=i),placeholder:"请输入用户名称",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"签署时间"},{default:s(()=>[e(P,{modelValue:o.filters.signTime,"onUpdate:modelValue":t[2]||(t[2]=i=>o.filters.signTime=i),type:"daterange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(f,null,{default:s(()=>[e(_,{type:"primary",onClick:c.handleSearch},{default:s(()=>[...t[8]||(t[8]=[r("查询",-1)])]),_:1},8,["onClick"]),e(_,{onClick:c.handleReset},{default:s(()=>[...t[9]||(t[9]=[r("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),e(R,{data:o.signRecords,style:{width:"100%"},stripe:"",height:"600","highlight-current-row":""},{default:s(()=>[e(u,{prop:"accountNumber",label:"账户号码",width:"150"}),e(u,{prop:"userName",label:"用户名称",width:"120"}),e(u,{prop:"protocolCreator",label:"协议创建方",width:"100"},{default:s(({row:i})=>[e(h,{type:c.getCreatorTagType(i.protocolCreator)},{default:s(()=>[r(d(i.protocolCreator),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"protocolCreatorName",label:"协议创建方名称",width:"150"}),e(u,{prop:"version",label:"签署的协议版本号",width:"150"}),e(u,{prop:"signTime",label:"签署时间",width:"180"}),e(u,{prop:"signAction",label:"签署动作",width:"120"},{default:s(({row:i})=>[e(h,{type:c.getSignActionTagType(i.signAction)},{default:s(()=>[r(d(c.getSignActionLabel(i.signAction)),1)]),_:2},1032,["type"])]),_:1}),e(u,{label:"操作",width:"120",fixed:"right"},{default:s(({row:i})=>[e(_,{size:"small",onClick:M(v=>c.viewSignDetail(i),["stop"])},{default:s(()=>[...t[10]||(t[10]=[r("查看详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(k,{class:"pagination",onSizeChange:c.handleSizeChange,onCurrentChange:c.handleCurrentChange,"current-page":o.pagination.currentPage,"page-sizes":[10,20,50,100],"page-size":o.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:o.pagination.total,style:{"margin-top":"20px","text-align":"right"}},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"]),e(z,{modelValue:o.detailDrawerVisible,"onUpdate:modelValue":t[3]||(t[3]=i=>o.detailDrawerVisible=i),size:"60%",title:`协议签署详情 - ${o.selectedRecord.userName}`,direction:"rtl"},{default:s(()=>[a("div",W,[e(b,{class:"info-card",shadow:"never"},{header:s(()=>[...t[11]||(t[11]=[a("div",{class:"card-header"},[a("span",null,"签署基本信息")],-1)])]),default:s(()=>[e(S,{column:2,border:""},{default:s(()=>[e(g,{label:"账户号码"},{default:s(()=>[r(d(o.selectedRecord.accountNumber),1)]),_:1}),e(g,{label:"用户名称"},{default:s(()=>[r(d(o.selectedRecord.userName),1)]),_:1}),e(g,{label:"协议版本"},{default:s(()=>[r(d(o.selectedRecord.version),1)]),_:1}),e(g,{label:"签署时间"},{default:s(()=>[r(d(o.selectedRecord.signTime),1)]),_:1}),e(g,{label:"签署动作"},{default:s(()=>[e(h,{type:c.getSignActionTagType(o.selectedRecord.signAction)},{default:s(()=>[r(d(c.getSignActionLabel(o.selectedRecord.signAction)),1)]),_:1},8,["type"])]),_:1}),e(g,{label:"签署状态"},{default:s(()=>[e(h,{type:o.selectedRecord.status==="completed"?"success":"warning"},{default:s(()=>[r(d(o.selectedRecord.status==="completed"?"已完成":"进行中"),1)]),_:1},8,["type"])]),_:1}),e(g,{label:"IP地址"},{default:s(()=>[r(d(o.selectedRecord.ipAddress),1)]),_:1}),e(g,{label:"设备信息"},{default:s(()=>[r(d(o.selectedRecord.deviceInfo),1)]),_:1})]),_:1})]),_:1}),e(b,{class:"info-card",shadow:"never",style:{"margin-top":"20px"}},{header:s(()=>[a("div",q,[a("span",null,"协议内容快照 ("+d(o.selectedRecord.snapshot?.version)+")",1)])]),default:s(()=>[a("div",G,[t[13]||(t[13]=a("h4",null,"协议附件",-1)),o.selectedRecord.snapshot?.attachments&&o.selectedRecord.snapshot.attachments.length>0?(m(),p("div",H,[(m(!0),p(N,null,T(o.selectedRecord.snapshot.attachments,(i,v)=>(m(),p("div",{key:v,class:"attachment-item"},[e(I,{type:"primary",underline:!1,onClick:y=>c.previewAttachment(i)},{default:s(()=>[e(x,null,{default:s(()=>[e(D)]),_:1}),r(" "+d(i.name),1)]),_:2},1032,["onClick"])]))),128))])):(m(),p("div",J,[...t[12]||(t[12]=[a("span",{class:"no-data"},"暂无附件",-1)])]))]),a("div",K,[t[15]||(t[15]=a("h4",null,"协议图片",-1)),o.selectedRecord.snapshot?.images&&o.selectedRecord.snapshot.images.length>0?(m(),p("div",O,[(m(!0),p(N,null,T(o.selectedRecord.snapshot.images,(i,v)=>(m(),p("div",{key:v,class:"image-item",style:{display:"inline-block","margin-right":"10px"}},[e(F,{src:i.url,"preview-src-list":o.selectedRecord.snapshot.images.map(y=>y.url),fit:"cover",style:{width:"100px",height:"100px",cursor:"pointer"}},null,8,["src","preview-src-list"])]))),128))])):(m(),p("div",Q,[...t[14]||(t[14]=[a("span",{class:"no-data"},"暂无图片",-1)])]))])]),_:1})])]),_:1},8,["modelValue","title"]),e(L,{modelValue:o.previewDialogVisible,"onUpdate:modelValue":t[4]||(t[4]=i=>o.previewDialogVisible=i),title:o.previewDialogTitle,width:"60%"},{default:s(()=>[a("div",X,[o.previewFileType==="pdf"?(m(),p("iframe",{key:0,src:o.previewFileUrl,width:"100%",height:"600px"},null,8,Z)):o.previewFileType==="image"?(m(),p("img",{key:1,src:o.previewFileUrl,style:{"max-width":"100%","max-height":"600px"}},null,8,$)):(m(),p("div",ee,[t[17]||(t[17]=a("p",null,"无法预览此文件类型",-1)),e(_,{type:"primary",onClick:c.downloadFile},{default:s(()=>[...t[16]||(t[16]=[r("下载文件",-1)])]),_:1},8,["onClick"])]))])]),_:1},8,["modelValue","title"])])}const le=U(B,[["render",te],["__scopeId","data-v-8e059f55"]]);export{le as default};
