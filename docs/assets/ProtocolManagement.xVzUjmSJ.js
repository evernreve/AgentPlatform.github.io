import{_ as B,u as O,i as j,c as p,o as c,a,b as e,w as l,r as m,d as n,t as h,h as V,e as N,F as E,f as Y}from"./index.DkWATejZ.js";const Z={name:"ProtocolManagement",components:{Document:j,UploadFilled:O},data(){return{filters:{protocolName:"",version:"",publishTime:["",""],creator:"",signParty:"",status:""},protocolData:[{id:1,protocolName:"断直连协议",version:"V20260129",creator:"PP",creatorName:"IPL集团",creatorId:"CREATOR001",signParty:"TP",publishTime:"2026-01-29 15:23:22",attachments:{cn:{name:"断直连协议_cn.pdf",url:"/files/断直连协议_cn.pdf"},en:{name:"Disconnection_Protocol_en.pdf",url:"/files/Disconnection_Protocol_en.pdf"}},images:{cn:{url:"/images/协议示例_cn.png"},en:{url:"/images/Protocol_Example_en.png"}},status:"published",needConfirm:!0,snapshots:[{version:"V20260129",createTime:"2026-01-29 15:23:22",contentHash:"hash_v20260129_001",attachments:[{name:"断直连协议_cn.pdf",url:"/files/断直连协议_cn.pdf"},{name:"Disconnection_Protocol_en.pdf",url:"/files/Disconnection_Protocol_en.pdf"}],images:[{url:"/images/协议示例_cn.png"},{url:"/images/Protocol_Example_en.png"}]}],auditTrail:[{id:"audit_001",action:"create",operator:"admin",timestamp:"2026-01-29 15:23:22",version:"V20260129",description:"创建新版本协议",ip:"192.168.1.100"}]},{id:2,protocolName:"服务协议",version:"V20260120",creator:"TP",creatorName:"合作伙伴科技",creatorId:"CREATOR002",signParty:"AP",publishTime:"2026-01-20 10:15:30",attachments:{cn:{name:"服务协议_cn.pdf",url:"/files/服务协议_cn.pdf"},en:null},images:{cn:null,en:null},status:"recycling",needConfirm:!1,snapshots:[{version:"V20260120",createTime:"2026-01-20 10:15:30",contentHash:"hash_v20260120_001",attachments:[{name:"服务协议_cn.pdf",url:"/files/服务协议_cn.pdf"}],images:[]}],auditTrail:[{id:"audit_002",action:"create",operator:"manager",timestamp:"2026-01-20 10:15:30",version:"V20260120",description:"创建服务协议",ip:"192.168.1.101"}]},{id:3,protocolName:"隐私协议",version:"V20260115",creator:"AP",creatorName:"安全科技有限公司",creatorId:"CREATOR003",signParty:"MP",publishTime:"2026-01-15 09:45:12",attachments:{cn:null,en:{name:"Privacy_Policy_en.pdf",url:"/files/Privacy_Policy_en.pdf"}},images:{cn:{url:"/images/隐私协议_cn.png"},en:null},status:"published",needConfirm:!0}],pagination:{currentPage:1,pageSize:10,total:3},protocolDialogVisible:!1,protocolFormTitle:"",isEdit:!1,protocolForm:{id:null,protocolName:"",version:"",publishTime:"",creator:"",signParty:"",needConfirm:!1},cnAttachmentList:[],enAttachmentList:[],cnImageList:[],enImageList:[],protocolFormRules:{protocolName:[{required:!0,message:"请选择协议名称",trigger:"change"}],version:[{required:!0,message:"请输入协议版本号",trigger:"blur"}],publishTime:[{required:!0,message:"请选择发布时间",trigger:"change"}],creator:[{required:!0,message:"请选择创建方",trigger:"change"}],signParty:[{required:!0,message:"请选择入驻协议签署方",trigger:"change"}],needConfirm:[{required:!0,message:"请选择是否需要用户确认",trigger:"change"}]},previewDialogVisible:!1,previewDialogTitle:"",previewFileUrl:"",previewFileType:"",protocolDetailDrawerVisible:!1,selectedProtocol:{},snapshotPreviewVisible:!1,previewSnapshotData:{}}},methods:{handleSearch(){console.log("搜索条件:",this.filters),this.$message.success("查询成功")},handleReset(){this.filters={protocolName:"",version:"",publishTime:["",""],creator:"",signParty:"",status:""}},handleAddProtocol(){this.isEdit=!1,this.protocolFormTitle="新增协议",this.resetProtocolForm(),this.protocolDialogVisible=!0},handleEditProtocol(s){this.isEdit=!0,this.protocolFormTitle="编辑协议",this.fillProtocolForm(s),this.protocolDialogVisible=!0},handleViewProtocol(s){this.$message.info(`查看协议: ${s.protocolName} ${s.version}`)},handleViewSignDetails(s){this.$router.push({path:`/main/monitor/contracts/protocol-sign-records/${s.id}`,query:{protocolId:s.id,protocolName:s.protocolName,version:s.version}})},handleViewSignRecords(){this.$router.push("/main/monitor/contracts/protocol-sign-records")},handleSizeChange(s){this.pagination.pageSize=s},handleCurrentChange(s){this.pagination.currentPage=s},resetProtocolForm(){this.protocolForm={id:null,protocolName:"",version:"",publishTime:"",creator:"",signParty:"",needConfirm:!1},this.cnAttachmentList=[],this.enAttachmentList=[],this.cnImageList=[],this.enImageList=[]},fillProtocolForm(s){this.protocolForm={...s},this.cnAttachmentList=s.attachments.cn?[s.attachments.cn]:[],this.enAttachmentList=s.attachments.en?[s.attachments.en]:[],this.cnImageList=s.images.cn?[s.images.cn]:[],this.enImageList=s.images.en?[s.images.en]:[]},handleCloseProtocolForm(){this.protocolDialogVisible=!1,this.resetProtocolForm()},handleSubmitProtocol(){this.$refs.protocolFormRef.validate(s=>{if(s){if(this.isEdit){const t=this.protocolData.findIndex(w=>w.id===this.protocolForm.id);if(t!==-1){const w=this.createProtocolSnapshot(this.protocolForm);this.protocolData[t].snapshots.push(w);const F=this.createAuditRecord("update",this.protocolForm);this.protocolData[t].auditTrail.push(F),this.protocolData[t]={...this.protocolForm,attachments:{cn:this.cnAttachmentList[0]||null,en:this.enAttachmentList[0]||null},images:{cn:this.cnImageList[0]||null,en:this.enImageList[0]||null}},this.$message.success("协议更新成功，已生成新的内容快照")}}else{const t={...this.protocolForm,id:Date.now(),attachments:{cn:this.cnAttachmentList[0]||null,en:this.enAttachmentList[0]||null},images:{cn:this.cnImageList[0]||null,en:this.enImageList[0]||null},snapshots:[],auditTrail:[]},w=this.createProtocolSnapshot(t);t.snapshots.push(w);const F=this.createAuditRecord("create",t);t.auditTrail.push(F),this.protocolData.push(t),this.$message.success("协议新增成功")}this.handleCloseProtocolForm()}else return this.$message.error("请完善表单信息"),!1})},handleCnAttachmentChange(s,t){this.cnAttachmentList=t.slice(-1)},handleEnAttachmentChange(s,t){this.enAttachmentList=t.slice(-1)},handleCnImageChange(s,t){this.cnImageList=t.slice(-1)},handleEnImageChange(s,t){this.enImageList=t.slice(-1)},previewAttachment(s){this.previewDialogTitle=s.name,this.previewFileUrl=s.url;const t=s.name.split(".").pop().toLowerCase();["pdf"].includes(t)?this.previewFileType="pdf":["jpg","jpeg","png","gif"].includes(t)?this.previewFileType="image":this.previewFileType="other",this.previewDialogVisible=!0},downloadFile(){this.$message.success("开始下载文件...")},handleViewProtocolDetail(s){this.selectedProtocol=s,this.protocolDetailDrawerVisible=!0},previewSnapshot(s){this.previewSnapshotData=s,this.snapshotPreviewVisible=!0},getStatusTagType(s){return{published:"success",recycling:"info"}[s]||"info"},getStatusLabel(s){return{published:"已发布",recycling:"回收使用中"}[s]||s},getCreatorTagType(s){return{PP:"primary",TP:"success",AP:"warning"}[s]||"info"},getSignPartyTagType(s){return{TP:"primary",AP:"success",MP:"warning"}[s]||"info"},createProtocolSnapshot(s){JSON.stringify({protocolName:s.protocolName,version:s.version,publishTime:s.publishTime,creator:s.creator,signParty:s.signParty,needConfirm:s.needConfirm,attachments:this.cnAttachmentList.concat(this.enAttachmentList),images:this.cnImageList.concat(this.enImageList)});const t="hash_"+s.version+"_"+Date.now();return{version:s.version,createTime:new Date().toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),contentHash:t,attachments:[...this.cnAttachmentList,...this.enAttachmentList].filter(Boolean),images:[...this.cnImageList,...this.enImageList].filter(Boolean)}},createAuditRecord(s,t){return{id:"audit_"+Date.now(),action:s,operator:"current_user",timestamp:new Date().toLocaleString("zh-CN",{timeZone:"Asia/Shanghai"}),version:t.version,description:s==="create"?`创建协议 ${t.protocolName} ${t.version}`:`更新协议 ${t.protocolName} ${t.version}`,ip:this.getClientIP()}},getClientIP(){return"192.168.1."+Math.floor(Math.random()*255)}}},J={class:"protocol-management"},G={class:"attachment-cell"},K={key:0},Q={key:1},W={key:2},X={class:"image-cell"},$={key:0,class:"image-preview"},ee={key:1,class:"image-preview"},te={key:2},le={class:"dialog-footer"},oe={class:"preview-content"},ie=["src"],se=["src"],ae={key:2},ne={class:"protocol-detail-content"},re={class:"attachments-section"},de={class:"attachment-group"},pe={key:0},ce={key:1},ue={class:"attachment-group",style:{"margin-top":"15px"}},me={key:0},he={key:1},ge={class:"images-section"},fe={class:"image-group"},ve={key:0,class:"image-preview"},_e={key:1},ye={class:"image-group",style:{"margin-top":"15px"}},be={key:0,class:"image-preview"},Pe={key:1},we={class:"snapshot-preview-content"},Ce={style:{"margin-top":"20px"}},Ve={key:0},Te={key:1},De={style:{"margin-top":"20px"}},ke={key:0},Fe={key:1};function Ae(s,t,w,F,o,r){const d=m("el-option"),b=m("el-select"),g=m("el-form-item"),I=m("el-input"),z=m("el-date-picker"),f=m("el-button"),U=m("el-form"),C=m("el-card"),u=m("el-table-column"),P=m("el-tag"),T=m("Document"),_=m("el-icon"),D=m("el-link"),k=m("el-image"),x=m("el-table"),H=m("el-pagination"),A=m("upload-filled"),S=m("el-upload"),L=m("el-dialog"),v=m("el-descriptions-item"),M=m("el-descriptions"),q=m("el-drawer");return c(),p("div",J,[t[53]||(t[53]=a("div",{class:"page-header"},[a("h3",null,"协议管理")],-1)),e(C,{class:"filter-card"},{default:l(()=>[e(U,{inline:!0,model:o.filters,class:"filter-form"},{default:l(()=>[e(g,{label:"协议名称"},{default:l(()=>[e(b,{modelValue:o.filters.protocolName,"onUpdate:modelValue":t[0]||(t[0]=i=>o.filters.protocolName=i),placeholder:"请选择协议名称",style:{width:"150px"}},{default:l(()=>[e(d,{label:"全部",value:""}),e(d,{label:"断直连协议",value:"断直连协议"}),e(d,{label:"服务协议",value:"服务协议"}),e(d,{label:"隐私协议",value:"隐私协议"}),e(d,{label:"入驻协议",value:"入驻协议"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"协议版本号"},{default:l(()=>[e(I,{modelValue:o.filters.version,"onUpdate:modelValue":t[1]||(t[1]=i=>o.filters.version=i),placeholder:"请输入协议版本号",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),e(g,{label:"发布时间"},{default:l(()=>[e(z,{modelValue:o.filters.publishTime,"onUpdate:modelValue":t[2]||(t[2]=i=>o.filters.publishTime=i),type:"daterange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(g,{label:"创建方"},{default:l(()=>[e(b,{modelValue:o.filters.creator,"onUpdate:modelValue":t[3]||(t[3]=i=>o.filters.creator=i),placeholder:"请选择创建方",style:{width:"120px"}},{default:l(()=>[e(d,{label:"全部",value:""}),e(d,{label:"PP",value:"PP"}),e(d,{label:"TP",value:"TP"}),e(d,{label:"AP",value:"AP"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"入驻协议签署方"},{default:l(()=>[e(b,{modelValue:o.filters.signParty,"onUpdate:modelValue":t[4]||(t[4]=i=>o.filters.signParty=i),placeholder:"请选择签署方",style:{width:"150px"}},{default:l(()=>[e(d,{label:"全部",value:""}),e(d,{label:"TP",value:"TP"}),e(d,{label:"AP",value:"AP"}),e(d,{label:"MP",value:"MP"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"状态"},{default:l(()=>[e(b,{modelValue:o.filters.status,"onUpdate:modelValue":t[5]||(t[5]=i=>o.filters.status=i),placeholder:"请选择状态",style:{width:"120px"}},{default:l(()=>[e(d,{label:"全部",value:""}),e(d,{label:"已发布",value:"published"}),e(d,{label:"回收使用中",value:"recycling"})]),_:1},8,["modelValue"])]),_:1}),e(g,null,{default:l(()=>[e(f,{type:"primary",onClick:r.handleSearch},{default:l(()=>[...t[18]||(t[18]=[n("查询",-1)])]),_:1},8,["onClick"]),e(f,{type:"primary",onClick:r.handleAddProtocol},{default:l(()=>[...t[19]||(t[19]=[n("新增",-1)])]),_:1},8,["onClick"]),e(f,{type:"primary",onClick:r.handleViewSignRecords},{default:l(()=>[...t[20]||(t[20]=[n("协议签署记录",-1)])]),_:1},8,["onClick"]),e(f,{onClick:r.handleReset},{default:l(()=>[...t[21]||(t[21]=[n("重置",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])]),_:1}),e(x,{data:o.protocolData,style:{width:"100%"},stripe:"",height:"600","highlight-current-row":""},{default:l(()=>[e(u,{prop:"protocolName",label:"协议名称",width:"150"}),e(u,{prop:"version",label:"协议版本号",width:"120"}),e(u,{prop:"creator",label:"创建方",width:"100"},{default:l(({row:i})=>[e(P,{type:r.getCreatorTagType(i.creator)},{default:l(()=>[n(h(i.creator),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"creatorName",label:"创建方名称",width:"150"}),e(u,{prop:"creatorId",label:"创建方编号",width:"120"}),e(u,{prop:"signParty",label:"入驻协议签署方",width:"150"},{default:l(({row:i})=>[e(P,{type:r.getSignPartyTagType(i.signParty),size:"small"},{default:l(()=>[n(h(i.signParty),1)]),_:2},1032,["type"])]),_:1}),e(u,{label:"协议附件(中/英)",width:"200"},{default:l(({row:i})=>[a("div",G,[i.attachments.cn?(c(),p("div",K,[e(D,{type:"primary",underline:!1,onClick:y=>r.previewAttachment(i.attachments.cn)},{default:l(()=>[e(_,null,{default:l(()=>[e(T)]),_:1}),n(" "+h(i.attachments.cn.name),1)]),_:2},1032,["onClick"])])):V("",!0),i.attachments.en?(c(),p("div",Q,[e(D,{type:"primary",underline:!1,onClick:y=>r.previewAttachment(i.attachments.en)},{default:l(()=>[e(_,null,{default:l(()=>[e(T)]),_:1}),n(" "+h(i.attachments.en.name),1)]),_:2},1032,["onClick"])])):V("",!0),!i.attachments.cn&&!i.attachments.en?(c(),p("div",W,[...t[22]||(t[22]=[a("span",{class:"no-attachment"},"暂无附件",-1)])])):V("",!0)])]),_:1}),e(u,{label:"协议图片(中/英)",width:"150"},{default:l(({row:i})=>[a("div",X,[i.images.cn?(c(),p("div",$,[e(k,{src:i.images.cn.url,"preview-src-list":[i.images.cn.url],fit:"cover",style:{width:"50px",height:"50px",cursor:"pointer"}},null,8,["src","preview-src-list"])])):V("",!0),i.images.en?(c(),p("div",ee,[e(k,{src:i.images.en.url,"preview-src-list":[i.images.en.url],fit:"cover",style:{width:"50px",height:"50px",cursor:"pointer"}},null,8,["src","preview-src-list"])])):V("",!0),!i.images.cn&&!i.images.en?(c(),p("div",te,[...t[23]||(t[23]=[a("span",{class:"no-image"},"暂无图片",-1)])])):V("",!0)])]),_:1}),e(u,{prop:"status",label:"状态",width:"120"},{default:l(({row:i})=>[e(P,{type:r.getStatusTagType(i.status)},{default:l(()=>[n(h(r.getStatusLabel(i.status)),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"needConfirm",label:"是否需要用户确认后展示",width:"200"},{default:l(({row:i})=>[a("span",null,h(i.needConfirm?"是":"否"),1)]),_:1}),e(u,{label:"操作",width:"220",fixed:"right"},{default:l(({row:i})=>[e(f,{size:"small",onClick:N(y=>r.handleEditProtocol(i),["stop"])},{default:l(()=>[...t[24]||(t[24]=[n("编辑",-1)])]),_:1},8,["onClick"]),e(f,{size:"small",onClick:N(y=>r.handleViewProtocolDetail(i),["stop"])},{default:l(()=>[...t[25]||(t[25]=[n("查看详情",-1)])]),_:1},8,["onClick"]),e(f,{size:"small",onClick:N(y=>r.handleViewSignDetails(i),["stop"])},{default:l(()=>[...t[26]||(t[26]=[n("签署详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(H,{class:"pagination",onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange,"current-page":o.pagination.currentPage,"page-sizes":[10,20,50,100],"page-size":o.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:o.pagination.total,style:{"margin-top":"20px","text-align":"right"}},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"]),e(L,{title:o.protocolFormTitle,modelValue:o.protocolDialogVisible,"onUpdate:modelValue":t[12]||(t[12]=i=>o.protocolDialogVisible=i),width:"60%","before-close":r.handleCloseProtocolForm},{footer:l(()=>[a("span",le,[e(f,{onClick:r.handleCloseProtocolForm},{default:l(()=>[...t[31]||(t[31]=[n("取消",-1)])]),_:1},8,["onClick"]),e(f,{type:"primary",onClick:r.handleSubmitProtocol},{default:l(()=>[...t[32]||(t[32]=[n("确定",-1)])]),_:1},8,["onClick"])])]),default:l(()=>[e(U,{model:o.protocolForm,rules:o.protocolFormRules,ref:"protocolFormRef","label-width":"140px"},{default:l(()=>[e(g,{label:"协议名称",prop:"protocolName"},{default:l(()=>[e(b,{modelValue:o.protocolForm.protocolName,"onUpdate:modelValue":t[6]||(t[6]=i=>o.protocolForm.protocolName=i),placeholder:"请选择协议名称",style:{width:"100%"}},{default:l(()=>[e(d,{label:"断直连协议",value:"断直连协议"}),e(d,{label:"服务协议",value:"服务协议"}),e(d,{label:"隐私协议",value:"隐私协议"}),e(d,{label:"入驻协议",value:"入驻协议"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"协议版本号",prop:"version"},{default:l(()=>[e(I,{modelValue:o.protocolForm.version,"onUpdate:modelValue":t[7]||(t[7]=i=>o.protocolForm.version=i),placeholder:"请输入协议版本号"},null,8,["modelValue"])]),_:1}),e(g,{label:"发布时间",prop:"publishTime"},{default:l(()=>[e(z,{modelValue:o.protocolForm.publishTime,"onUpdate:modelValue":t[8]||(t[8]=i=>o.protocolForm.publishTime=i),type:"datetime",placeholder:"选择发布时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(g,{label:"创建方",prop:"creator"},{default:l(()=>[e(b,{modelValue:o.protocolForm.creator,"onUpdate:modelValue":t[9]||(t[9]=i=>o.protocolForm.creator=i),placeholder:"请选择创建方",style:{width:"100%"}},{default:l(()=>[e(d,{label:"PP",value:"PP"}),e(d,{label:"TP",value:"TP"}),e(d,{label:"AP",value:"AP"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"入驻协议签署方",prop:"signParty"},{default:l(()=>[e(b,{modelValue:o.protocolForm.signParty,"onUpdate:modelValue":t[10]||(t[10]=i=>o.protocolForm.signParty=i),placeholder:"请选择签署方",style:{width:"100%"}},{default:l(()=>[e(d,{label:"TP",value:"TP"}),e(d,{label:"AP",value:"AP"}),e(d,{label:"MP",value:"MP"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"是否需要用户确认后展示",prop:"needConfirm"},{default:l(()=>[e(b,{modelValue:o.protocolForm.needConfirm,"onUpdate:modelValue":t[11]||(t[11]=i=>o.protocolForm.needConfirm=i),placeholder:"请选择",style:{width:"100%"}},{default:l(()=>[e(d,{label:"是",value:!0}),e(d,{label:"否",value:!1})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"协议附件中文"},{default:l(()=>[e(S,{class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":r.handleCnAttachmentChange,"file-list":o.cnAttachmentList},{default:l(()=>[e(_,{class:"el-icon--upload"},{default:l(()=>[e(A)]),_:1}),t[27]||(t[27]=a("div",{class:"el-upload__text"},[n(" 将文件拖到此处，或"),a("em",null,"点击上传")],-1))]),_:1},8,["on-change","file-list"])]),_:1}),e(g,{label:"协议附件英文"},{default:l(()=>[e(S,{class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":r.handleEnAttachmentChange,"file-list":o.enAttachmentList},{default:l(()=>[e(_,{class:"el-icon--upload"},{default:l(()=>[e(A)]),_:1}),t[28]||(t[28]=a("div",{class:"el-upload__text"},[n(" 将文件拖到此处，或"),a("em",null,"点击上传")],-1))]),_:1},8,["on-change","file-list"])]),_:1}),e(g,{label:"协议图片中文"},{default:l(()=>[e(S,{class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":r.handleCnImageChange,"file-list":o.cnImageList,"list-type":"picture"},{default:l(()=>[e(_,{class:"el-icon--upload"},{default:l(()=>[e(A)]),_:1}),t[29]||(t[29]=a("div",{class:"el-upload__text"},[n(" 将图片拖到此处，或"),a("em",null,"点击上传")],-1))]),_:1},8,["on-change","file-list"])]),_:1}),e(g,{label:"协议图片英文"},{default:l(()=>[e(S,{class:"upload-demo",drag:"",action:"#","auto-upload":!1,"on-change":r.handleEnImageChange,"file-list":o.enImageList,"list-type":"picture"},{default:l(()=>[e(_,{class:"el-icon--upload"},{default:l(()=>[e(A)]),_:1}),t[30]||(t[30]=a("div",{class:"el-upload__text"},[n(" 将图片拖到此处，或"),a("em",null,"点击上传")],-1))]),_:1},8,["on-change","file-list"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"]),e(L,{modelValue:o.previewDialogVisible,"onUpdate:modelValue":t[13]||(t[13]=i=>o.previewDialogVisible=i),title:o.previewDialogTitle,width:"60%"},{default:l(()=>[a("div",oe,[o.previewFileType==="pdf"?(c(),p("iframe",{key:0,src:o.previewFileUrl,width:"100%",height:"600px"},null,8,ie)):o.previewFileType==="image"?(c(),p("img",{key:1,src:o.previewFileUrl,style:{"max-width":"100%","max-height":"600px"}},null,8,se)):(c(),p("div",ae,[t[34]||(t[34]=a("p",null,"无法预览此文件类型",-1)),e(f,{type:"primary",onClick:r.downloadFile},{default:l(()=>[...t[33]||(t[33]=[n("下载文件",-1)])]),_:1},8,["onClick"])]))])]),_:1},8,["modelValue","title"]),e(q,{modelValue:o.protocolDetailDrawerVisible,"onUpdate:modelValue":t[16]||(t[16]=i=>o.protocolDetailDrawerVisible=i),size:"70%",title:`协议详情 - ${o.selectedProtocol.protocolName}`,direction:"rtl"},{default:l(()=>[a("div",ne,[e(C,{class:"detail-card",shadow:"never"},{header:l(()=>[...t[35]||(t[35]=[a("div",{class:"card-header"},[a("span",null,"协议基本信息")],-1)])]),default:l(()=>[e(M,{column:2,border:""},{default:l(()=>[e(v,{label:"协议名称"},{default:l(()=>[n(h(o.selectedProtocol.protocolName),1)]),_:1}),e(v,{label:"协议版本号"},{default:l(()=>[n(h(o.selectedProtocol.version),1)]),_:1}),e(v,{label:"创建方"},{default:l(()=>[e(P,{type:r.getCreatorTagType(o.selectedProtocol.creator)},{default:l(()=>[n(h(o.selectedProtocol.creator),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"入驻协议签署方"},{default:l(()=>[e(P,{type:r.getSignPartyTagType(o.selectedProtocol.signParty)},{default:l(()=>[n(h(o.selectedProtocol.signParty),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"发布时间"},{default:l(()=>[n(h(o.selectedProtocol.publishTime),1)]),_:1}),e(v,{label:"状态"},{default:l(()=>[e(P,{type:r.getStatusTagType(o.selectedProtocol.status)},{default:l(()=>[n(h(r.getStatusLabel(o.selectedProtocol.status)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"是否需要用户确认"},{default:l(()=>[a("span",null,h(o.selectedProtocol.needConfirm?"是":"否"),1)]),_:1})]),_:1})]),_:1}),e(C,{class:"detail-card",shadow:"never",style:{"margin-top":"20px"}},{header:l(()=>[...t[36]||(t[36]=[a("div",{class:"card-header"},[a("span",null,"协议附件")],-1)])]),default:l(()=>[a("div",re,[a("div",de,[t[38]||(t[38]=a("h4",null,"中文附件",-1)),o.selectedProtocol.attachments?.cn?(c(),p("div",pe,[e(D,{type:"primary",underline:!1,onClick:t[14]||(t[14]=i=>r.previewAttachment(o.selectedProtocol.attachments.cn))},{default:l(()=>[e(_,null,{default:l(()=>[e(T)]),_:1}),n(" "+h(o.selectedProtocol.attachments.cn.name),1)]),_:1})])):(c(),p("div",ce,[...t[37]||(t[37]=[a("span",{class:"no-data"},"暂无中文附件",-1)])]))]),a("div",ue,[t[40]||(t[40]=a("h4",null,"英文附件",-1)),o.selectedProtocol.attachments?.en?(c(),p("div",me,[e(D,{type:"primary",underline:!1,onClick:t[15]||(t[15]=i=>r.previewAttachment(o.selectedProtocol.attachments.en))},{default:l(()=>[e(_,null,{default:l(()=>[e(T)]),_:1}),n(" "+h(o.selectedProtocol.attachments.en.name),1)]),_:1})])):(c(),p("div",he,[...t[39]||(t[39]=[a("span",{class:"no-data"},"暂无英文附件",-1)])]))])])]),_:1}),e(C,{class:"detail-card",shadow:"never",style:{"margin-top":"20px"}},{header:l(()=>[...t[41]||(t[41]=[a("div",{class:"card-header"},[a("span",null,"协议图片")],-1)])]),default:l(()=>[a("div",ge,[a("div",fe,[t[43]||(t[43]=a("h4",null,"中文图片",-1)),o.selectedProtocol.images?.cn?(c(),p("div",ve,[e(k,{src:o.selectedProtocol.images.cn.url,"preview-src-list":[o.selectedProtocol.images.cn.url],fit:"cover",style:{width:"120px",height:"120px",cursor:"pointer"}},null,8,["src","preview-src-list"])])):(c(),p("div",_e,[...t[42]||(t[42]=[a("span",{class:"no-data"},"暂无中文图片",-1)])]))]),a("div",ye,[t[45]||(t[45]=a("h4",null,"英文图片",-1)),o.selectedProtocol.images?.en?(c(),p("div",be,[e(k,{src:o.selectedProtocol.images.en.url,"preview-src-list":[o.selectedProtocol.images.en.url],fit:"cover",style:{width:"120px",height:"120px",cursor:"pointer"}},null,8,["src","preview-src-list"])])):(c(),p("div",Pe,[...t[44]||(t[44]=[a("span",{class:"no-data"},"暂无英文图片",-1)])]))])])]),_:1}),e(C,{class:"detail-card",shadow:"never",style:{"margin-top":"20px"}},{header:l(()=>[...t[46]||(t[46]=[a("div",{class:"card-header"},[a("span",null,"内容快照历史")],-1)])]),default:l(()=>[e(x,{data:o.selectedProtocol.snapshots,style:{width:"100%"},size:"small"},{default:l(()=>[e(u,{prop:"version",label:"版本号",width:"120"}),e(u,{prop:"createTime",label:"创建时间",width:"180"}),e(u,{prop:"contentHash",label:"内容哈希",width:"200"}),e(u,{label:"附件数量",width:"100"},{default:l(i=>[n(h(i.row.attachments?.length||0),1)]),_:1}),e(u,{label:"图片数量",width:"100"},{default:l(i=>[n(h(i.row.images?.length||0),1)]),_:1}),e(u,{label:"操作",width:"120"},{default:l(i=>[e(f,{size:"small",onClick:y=>r.previewSnapshot(i.row)},{default:l(()=>[...t[47]||(t[47]=[n("查看内容",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(C,{class:"detail-card",shadow:"never",style:{"margin-top":"20px"}},{header:l(()=>[...t[48]||(t[48]=[a("div",{class:"card-header"},[a("span",null,"变更记录")],-1)])]),default:l(()=>[e(x,{data:o.selectedProtocol.auditTrail,style:{width:"100%"},size:"small"},{default:l(()=>[e(u,{prop:"timestamp",label:"变更时间",width:"180"}),e(u,{prop:"action",label:"操作类型",width:"100"},{default:l(i=>[e(P,{type:i.row.action==="create"?"success":"warning"},{default:l(()=>[n(h(i.row.action==="create"?"创建":"更新"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"operator",label:"操作人",width:"120"}),e(u,{prop:"version",label:"协议版本",width:"120"}),e(u,{prop:"ip",label:"操作IP",width:"150"}),e(u,{prop:"description",label:"描述"})]),_:1},8,["data"])]),_:1})])]),_:1},8,["modelValue","title"]),e(L,{modelValue:o.snapshotPreviewVisible,"onUpdate:modelValue":t[17]||(t[17]=i=>o.snapshotPreviewVisible=i),title:`快照内容 - ${o.previewSnapshotData.version}`,width:"60%"},{default:l(()=>[a("div",we,[e(M,{column:1,border:""},{default:l(()=>[e(v,{label:"版本号"},{default:l(()=>[n(h(o.previewSnapshotData.version),1)]),_:1}),e(v,{label:"创建时间"},{default:l(()=>[n(h(o.previewSnapshotData.createTime),1)]),_:1}),e(v,{label:"内容哈希"},{default:l(()=>[n(h(o.previewSnapshotData.contentHash),1)]),_:1})]),_:1}),a("div",Ce,[t[50]||(t[50]=a("h4",null,"附件列表",-1)),o.previewSnapshotData.attachments&&o.previewSnapshotData.attachments.length>0?(c(),p("div",Ve,[(c(!0),p(E,null,Y(o.previewSnapshotData.attachments,(i,y)=>(c(),p("div",{key:y,class:"attachment-item"},[e(D,{type:"primary",underline:!1,onClick:R=>r.previewAttachment(i)},{default:l(()=>[e(_,null,{default:l(()=>[e(T)]),_:1}),n(" "+h(i.name),1)]),_:2},1032,["onClick"])]))),128))])):(c(),p("div",Te,[...t[49]||(t[49]=[a("span",{class:"no-data"},"暂无附件",-1)])]))]),a("div",De,[t[52]||(t[52]=a("h4",null,"图片列表",-1)),o.previewSnapshotData.images&&o.previewSnapshotData.images.length>0?(c(),p("div",ke,[(c(!0),p(E,null,Y(o.previewSnapshotData.images,(i,y)=>(c(),p("div",{key:y,class:"image-item",style:{display:"inline-block","margin-right":"10px"}},[e(k,{src:i.url,"preview-src-list":o.previewSnapshotData.images.map(R=>R.url),fit:"cover",style:{width:"100px",height:"100px",cursor:"pointer"}},null,8,["src","preview-src-list"])]))),128))])):(c(),p("div",Fe,[...t[51]||(t[51]=[a("span",{class:"no-data"},"暂无图片",-1)])]))])])]),_:1},8,["modelValue","title"])])}const xe=B(Z,[["render",Ae],["__scopeId","data-v-7e68f39e"]]);export{xe as default};
